<section class="container py-4">
  <h2 class="mb-4">Mi Historial de Alquileres</h2>

  <!-- Filtros como botones segmentados -->
  <div class="d-flex justify-content-between mb-3">
    <input
      v-model="busqueda"
      type="text"
      class="form-control w-50"
      placeholder="Buscar por título o autor"
    />

    <div class="btn-group ms-3" role="group">
      <button
        type="button"
        class="btn rounded-pill px-3"
        :class="estadoFiltro === '' ? 'btn-dark text-white' : 'btn-outline-dark'"
        @click="estadoFiltro = ''"
      >
        Todos
      </button>
      <button
        type="button"
        class="btn rounded-pill px-3"
        :class="estadoFiltro === 'En Curso' ? 'btn-warning text-dark' : 'btn-outline-warning'"
        @click="estadoFiltro = 'En Curso'"
      >
        En Curso
      </button>
      <button
        type="button"
        class="btn rounded-pill px-3"
        :class="estadoFiltro === 'Devuelto' ? 'btn-success text-white' : 'btn-outline-success'"
        @click="estadoFiltro = 'Devuelto'"
      >
        Devuelto
      </button>
      <button
        type="button"
        class="btn rounded-pill px-3"
        :class="estadoFiltro === 'Retrasado' ? 'btn-danger text-white' : 'btn-outline-danger'"
        @click="estadoFiltro = 'Retrasado'"
      >
        Retrasado
      </button>
    </div>
  </div>

  <!-- Tabla -->
  <table class="table table-bordered table-hover" v-if="prestamosPaginados.length">
    <thead class="table-dark">
      <tr>
        <th>Imagen</th>
        <th>Título</th>
        <th>Autor</th>
        <th>Fecha de Alquiler</th>
        <th>Fecha de Devolución</th>
        <th>Estado</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="p in prestamosPaginados" :key="p.id">
        <td>
          <img
            :src="p.foto"
            alt="Portada"
            class="rounded"
            style="width: 60px; height: 90px; object-fit: cover;"
            @error="imagenError($event)"
          />
        </td>
        <td>{{ p.titulo }}</td>
        <td>{{ p.autor }}</td>
        <td>{{ formatDate(p.fechaAlquiler) }}</td>
        <td>{{ formatDate(p.fechaDevolucion) }}</td>
        <td>
          <span
            :class="[
              'badge',
              p.estado === 'Devuelto'
                ? 'bg-success'
                : p.estado === 'En Curso'
                ? 'bg-warning text-dark'
                : 'bg-danger'
            ]"
          >
            {{ p.estado }}
          </span>
        </td>
        <td>
          <button
            v-if="p.estado === 'Devuelto'"
            class="btn btn-sm btn-outline-success rounded-pill me-1"
            @click="renovar(p)"
          >
            Renovar Préstamo
          </button>
          <button
            class="btn btn-sm btn-outline-primary rounded-pill"
            @click="verDetalles(p)"
          >
            Ver Detalles
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Sin resultados -->
  <div v-else class="text-muted">No hay préstamos para mostrar</div>

  <!-- Paginación -->
  <div class="d-flex justify-content-between align-items-center mt-3">
    <div>
      Mostrando {{ fromIndex + 1 }} a {{ toIndex }} de {{ prestamosFiltrados.length }} resultados
    </div>
    <div>
      <button
        class="btn btn-outline-secondary btn-sm rounded-pill me-2"
        :disabled="page === 1"
        @click="page--"
      >
        Anterior
      </button>
      <button
        class="btn btn-outline-secondary btn-sm rounded-pill"
        :disabled="toIndex >= prestamosFiltrados.length"
        @click="page++"
      >
        Siguiente
      </button>
    </div>
  </div>
</section>
